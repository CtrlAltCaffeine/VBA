Sub ImportAndAnalyzeNifty50Data()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Nifty50Data")
    
    ' Clear existing data
    ws.Cells.Clear
    
    ' Import CSV data
    With ws.QueryTables.Add(Connection:="TEXT;nifty_50_data.csv", Destination:=ws.Range("A1"))
        .TextFileParseType = xlDelimited
        .TextFileConsecutiveDelimiter = False
        .TextFileTabDelimiter = False
        .TextFileSemicolonDelimiter = False
        .TextFileCommaDelimiter = True
        .TextFilePlatform = xlWindows
        .Refresh BackgroundQuery:=False
    End With
    
    ' Calculate average closing price for each stock
    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    Dim stockSymbols As Collection
    Set stockSymbols = New Collection
    
    Dim i As Long
    For i = 2 To lastRow
        On Error Resume Next
        stockSymbols.Add ws.Cells(i, 1).Value, CStr(ws.Cells(i, 1).Value)
        On Error GoTo 0
    Next i
    
    Dim stock As Variant
    Dim startRow As Long
    Dim endRow As Long
    Dim totalClose As Double
    Dim count As Long
    Dim avgClose As Double
    Dim outputRow As Long
    outputRow = 2
    
    ws.Cells(1, "G").Value = "Stock Symbol"
    ws.Cells(1, "H").Value = "Average Closing Price"
    
    For Each stock In stockSymbols
        startRow = Application.WorksheetFunction.Match(stock, ws.Columns("A"), 0)
        endRow = Application.WorksheetFunction.Match(stock & ".99999999999", ws.Columns("A"), 1) - 1
        
        totalClose = Application.WorksheetFunction.Sum(ws.Range("F" & startRow & ":F" & endRow))
        count = endRow - startRow + 1
        avgClose = totalClose / count
        
        ws.Cells(outputRow, "G").Value = stock
        ws.Cells(outputRow, "H").Value = avgClose
        
        outputRow = outputRow + 1
    Next stock
    
    MsgBox "Data import and analysis complete!", vbInformation
End Sub

import pandas as pd
import numpy as np

def greedy_pair_and_diff(path_a, path_b, sheet_name=None):
    dfA = pd.read_excel(path_a, sheet_name=sheet_name, dtype=str).fillna("")
    dfB = pd.read_excel(path_b, sheet_name=sheet_name, dtype=str).fillna("")
    cols = [c for c in dfA.columns if c in dfB.columns]
    dfA = dfA[cols].reset_index(drop=True)
    dfB = dfB[cols].reset_index(drop=True)

    nA, nB = len(dfA), len(dfB)
    usedB = np.zeros(nB, dtype=bool)
    differences = []

    arrA = dfA.values.astype(str)
    arrB = dfB.values.astype(str)

    for i in range(nA):
        mask = ~usedB
        if not mask.any():
            break
        candidates = np.where(mask)[0]
        eq = (arrB[candidates, :] == arrA[i, :])
        scores = eq.sum(axis=1)
        best_idx = candidates[np.argmax(scores)]
        usedB[best_idx] = True

        diff_cols = []
        for k, col in enumerate(cols):
            if arrA[i, k] != arrB[best_idx, k]:
                diff_cols.append((col, arrA[i, k], arrB[best_idx, k]))

        if diff_cols:
            differences.append({
                "rowA_index": i,
                "rowB_index": int(best_idx),
                "diff_count": len(diff_cols),
                "diffs": diff_cols
            })

    unmatched_B = list(np.where(~usedB)[0])
    return differences, unmatched_B

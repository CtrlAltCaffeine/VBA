Sub ImportAndAnalyzeNifty50Data()
    Dim ws As Worksheet
    Set ws = ThisWorkbook.Sheets("Nifty50Data")
    
    ' Clear existing data
    ws.Cells.Clear
    
    ' Import CSV data
    With ws.QueryTables.Add(Connection:="TEXT;nifty_50_data.csv", Destination:=ws.Range("A1"))
        .TextFileParseType = xlDelimited
        .TextFileConsecutiveDelimiter = False
        .TextFileTabDelimiter = False
        .TextFileSemicolonDelimiter = False
        .TextFileCommaDelimiter = True
        .TextFilePlatform = xlWindows
        .Refresh BackgroundQuery:=False
    End With
    
    ' Calculate average closing price for each stock
    Dim lastRow As Long
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    
    Dim stockSymbols As Collection
    Set stockSymbols = New Collection
    
    Dim i As Long
    For i = 2 To lastRow
        On Error Resume Next
        stockSymbols.Add ws.Cells(i, 1).Value, CStr(ws.Cells(i, 1).Value)
        On Error GoTo 0
    Next i
    
    Dim stock As Variant
    Dim startRow As Long
    Dim endRow As Long
    Dim totalClose As Double
    Dim count As Long
    Dim avgClose As Double
    Dim outputRow As Long
    outputRow = 2
    
    ws.Cells(1, "G").Value = "Stock Symbol"
    ws.Cells(1, "H").Value = "Average Closing Price"
    
    For Each stock In stockSymbols
        startRow = Application.WorksheetFunction.Match(stock, ws.Columns("A"), 0)
        endRow = Application.WorksheetFunction.Match(stock & ".99999999999", ws.Columns("A"), 1) - 1
        
        totalClose = Application.WorksheetFunction.Sum(ws.Range("F" & startRow & ":F" & endRow))
        count = endRow - startRow + 1
        avgClose = totalClose / count
        
        ws.Cells(outputRow, "G").Value = stock
        ws.Cells(outputRow, "H").Value = avgClose
        
        outputRow = outputRow + 1
    Next stock
    
    MsgBox "Data import and analysis complete!", vbInformation
End Sub

import pandas as pd
from collections import Counter

file = "your_file.xlsx"
s1 = pd.read_excel(file, sheet_name="Sheet1")
s2 = pd.read_excel(file, sheet_name="Sheet2")

key = "Pbaccntid"
cols = [c for c in s1.columns if c != key]

ids1 = set(s1[key].unique())
ids2 = set(s2[key].unique())
only_in_1 = sorted(list(ids1 - ids2))
only_in_2 = sorted(list(ids2 - ids1))
all_ids = sorted(list(ids1.union(ids2)))

rows_count = []
col_match_summary = []

def col_multiset(df, pid, col):
    vals = df.loc[df[key] == pid, col].fillna("<NA>").astype(str).tolist()
    return Counter(vals)

def row_multiset(df, pid):
    rows = df.loc[df[key] == pid, cols].fillna("<NA>").astype(str).apply(lambda r: tuple(r.tolist()), axis=1).tolist()
    return Counter(rows)

for pid in all_ids:
    c1 = int((s1[key] == pid).sum())
    c2 = int((s2[key] == pid).sum())
    rows_count.append({"Pbaccntid": pid, "rows_in_Sheet1": c1, "rows_in_Sheet2": c2})
    if c1 == 0:
        col_match_summary.append({"Pbaccntid": pid, "status": "only_in_Sheet2", "matching_columns": [], "non_matching_columns": cols[:]})
        continue
    if c2 == 0:
        col_match_summary.append({"Pbaccntid": pid, "status": "only_in_Sheet1", "matching_columns": [], "non_matching_columns": cols[:]})
        continue
    row_ms1 = row_multiset(s1, pid)
    row_ms2 = row_multiset(s2, pid)
    if c1 == c2 and row_ms1 == row_ms2:
        col_match_summary.append({"Pbaccntid": pid, "status": "all_rows_and_columns_match", "matching_columns": cols[:], "non_matching_columns": []})
        continue
    matching_cols = []
    non_matching_cols = []
    for col in cols:
        if col_multiset(s1, pid, col) == col_multiset(s2, pid, col):
            matching_cols.append(col)
        else:
            non_matching_cols.append(col)
    status = "counts_equal_but_some_rows_differ" if c1 == c2 else "counts_differ"
    col_match_summary.append({"Pbaccntid": pid, "status": status, "matching_columns": matching_cols, "non_matching_columns": non_matching_cols})

df_counts = pd.DataFrame(rows_count)
df_col_summary = pd.DataFrame(col_match_summary)

print("Pbaccntid only in Sheet1:", only_in_1)
print("Pbaccntid only in Sheet2:", only_in_2)
print("\nRows count per Pbaccntid:")
print(df_counts.to_string(index=False))
print("\nColumn match summary per Pbaccntid:")
print(df_col_summary.to_string(index=False))
